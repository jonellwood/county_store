<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="Description" content="General Store" />
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
    </script>

    <link href="./style/storeLux.css" rel="stylesheet" />
    <link href="./style/mediaQueries.css" rel="stylesheet" />
    <link href="./style/viewTransitions.css" rel="stylesheet" />
    <link href="./style/custom.css" rel="stylesheet" />
    <script src="functions/autoClosePopover.js"></script>
    <link rel="icon" type="image/x-icon" href="./favicons/favicon.ico">
    <meta name="view-transition" content="same-origin">

    <title>BC Store</title>
    <script>
        // function to scroll to top of page to be fired as part of click hander when users selects menu item and opens the popover
        function scrollToTop() {
            console.log('Scrolling to top');
            window.scrollTo(0, 0);
        }
    </script>
</head>

<body class="body">
    <header>
        <nav class="navbar navbar-expand-lg bg-dark" data-bs-theme="dark">
            <div class="container-fluid align-items-baseline">
                <a class="navbar-brand" href="index.php">
                    <img src="assets/images/bc-seal.png" class="m-2" alt="logo" width="75px" />
                </a>
                <div class="m-2 border-right"></div>
                <button class="navbar-toggler" type="button" popovertarget="navbar-popover" popovertargetaction="show"
                    id="navbar-popover-toggle">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarColor02">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <button class="nav-link" href="#" popovertarget="mens-menu-popover"
                                popovertargetaction="show" onclick="scrollToTop()" id="mens-menu-anchor"
                                role="button">MEN
                                <span class="visually-hidden">(current)</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" href="#" popovertarget="womans-menu-popover"
                                popovertargetaction="show" onclick="scrollToTop()" id="womans-menu-anchor"
                                role="button">WOMEN</button>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="boots-details.php">BOOTS</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="hats-view.php">HATS</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="accessories-view.php">ACCESSORIES</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="support.php">SUPPORT</a>
                        </li>
                    </ul>
                </div>
                <div class="collapse navbar-collapse" id="navbarColor02">
                    <div class="d-flex align-items-center align-self-center flex-grow-1 m-2">
                        <button class="btn btn-outline-primary nav-link" title="View Cart" popovertarget="cart-slideout"
                            role="button">
                            <img src="assets/icons/cart.svg" alt="cart" width="35px" class="m-0 p-0" />
                            (1 Items)
                            </p>
                    </div>
                    <form action="search.php" method="post" class="d-flex">
                        <input class="form-control me-sm-2" type="text" name="param" placeholder="Search...">
                        <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
                    </form>
                </div>
            </div>
        </nav>
    </header>

    <div id="mens-menu-popover" popover=manual>
        <button popovertarget="mens-menu-popover" popovertargetaction="hide" class="btn-close ms-2 mb-1" role="button">
            <span aria-hidden="true"></span>
        </button>
        <ul class="list-group">
            <li>
                <a href="mens-shirts-view.php"
                    class="list-group-item list-group-item-dark d-flex justify-content-between align-items-center">
                    Shirts
                    <img src="assets/icons/polo-shirt.svg" alt="shirt" width="25px" />
                </a>
            </li>
            <li>
                <a href="mens-outerwear-view.php"
                    class="list-group-item list-group-item-info d-flex justify-content-between align-items-center">
                    Outerwear
                    <img src="assets/icons/winter-jacket.svg" alt="jacket" width="25px" />
                </a>
            </li>
            <li>
                <a href="mens-sweatshirts-view.php"
                    class="list-group-item list-group-item-dark d-flex justify-content-between align-items-center">
                    Sweatshirts
                    <img src="assets/icons/hoodie-jacket.svg" alt="shirt" width="25px" />
                </a>
            </li>
            <li> <a href="mens-bnt-view.php"
                    class="list-group-item list-group-item-info d-flex justify-content-between align-items-center">
                    Big & Tall
                    <img src="assets/icons/shirt.svg" alt="shirt" width="25px" />
                </a>
            </li>
        </ul>
    </div>
    <div id="womans-menu-popover" popover=manual>
        <button popovertarget="womans-menu-popover" popovertargetaction="hide" class="btn-close ms-2 mb-1"
            role="button">
            <span aria-hidden="true"></span>
        </button>
        <ul class="list-group">
            <li>
                <a href="ladies-shirts-view.php"
                    class="list-group-item list-group-item-dark d-flex justify-content-between align-items-center">
                    Shirts
                    <img src="assets/icons/polo-shirt.svg" alt="shirt" width="25px" />
                </a>
            </li>
            <li>
                <a href="ladies-outerwear-view.php"
                    class="list-group-item list-group-item-danger d-flex justify-content-between align-items-center">
                    Outerwear
                    <img src="assets/icons/winter-jacket.svg" alt="jacket" width="25px" />
                </a>
            </li>
            <li>
                <a href="ladies-sweatshirts-view.php"
                    class="list-group-item list-group-item-dark d-flex justify-content-between align-items-center">
                    Sweatshirts
                    <img src="assets/icons/hoodie-jacket.svg" alt="shirt" width="25px" />
                </a>
            </li>
            <li>
                <a href="ladies-plus-view.php"
                    class="list-group-item list-group-item-danger d-flex justify-content-between align-items-center">
                    Plus Size
                    <img src="assets/icons/shirt.svg" alt="shirt" width="25px" />
                </a>
            </li>
        </ul>
    </div>

    <div id="navbar-popover" popover=manual class="navbar-popover">
        <span class="navbar-popover-header">
            <button popovertarget="navbar-popover" popovertargetaction="hide" class="btn-close ms-2 mb-1">
                <span aria-hidden="true"></span>
            </button>
        </span>
        <div id="cart-popover-container">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <button class="nav-link" href="#" popovertarget="mens-menu-popover" popovertargetaction="show"
                        onclick="scrollToTop()" id="mens-menu-anchor" role="button">MENS
                        <span class="visually-hidden">(current)</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" href="#" popovertarget="womans-menu-popover" popovertargetaction="show"
                        onclick="scrollToTop()" id="womans-menu-anchor" role="button">WOMANS</button>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="boots-details.php">BOOTS</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="hats-view.php">HATS</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="accessories-view.php">ACCESSORIES</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="support.php">SUPPORT</a>
                </li>
            </ul>

        </div>
    </div>

    <div id="cart-slideout" popover=manual>
        <div id="cart-slideout-container">
            <script>
                function setCartInLocalStorage() {
                    var cart = {
                        "cart_total": 24.82,
                        "total_items": 1,
                        "total_logo_fees": 5,
                        "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a": {
                            "id": 91,
                            "name": "CornerStone Tall Select Lightweight Snag-Proof Polo",
                            "price": "24.82",
                            "qty": 1,
                            "add_item_uid": "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a",
                            "image": "product-images\/black_tlcs418.jpg",
                            "code": "TLCS418",
                            "logoFee": 5,
                            "tax": 2.6837999999999997,
                            "price_id": "3139",
                            "color_id": "6",
                            "color_name": "Black",
                            "size_id": "15",
                            "size_name": "Large & Tall (LT)",
                            "comment": "",
                            "logo": "dept_logos\/B_Black_Dept.png",
                            "logo_id": "31",
                            "deptPatchPlace": "Below Logo",
                            "fy": "2526",
                            "rowid": "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a",
                            "subtotal": 24.82,
                            "logoFeeSubtotal": 5,
                            "subtotalWithLogoFee": 29.82
                        }
                    };
                    // console.log('cart');
                    // console.log(cart);
                    cart.timestamp = new Date().toISOString();
                    localStorage.setItem('store-cart', JSON.stringify(cart));

                }
                //setCartInLocalStorage();


                function getCartFromLocalStorage() {
                    var cartData = localStorage.getItem('store-cart');
                    if (cartData) {
                        return JSON.parse(cartData);
                    } else {
                        setCartInLocalStorage();
                    }
                    // return;
                }
                getCartFromLocalStorage();
                // helper function for comparing arrays of carts ... that I don't think I actually need now.
                function findItemByUid(array, uid) {
                    return array.find(item => item.add_item_uid === uid);
                }
                // helper function to compare a timestamp in local storage against now() to see the age
                function howOldIsLocalStorage(str) {
                    var now = new Date();
                    var older = new Date(str)
                    var gap = (now - older);
                    return gap;
                }

                function flattenEntries(ent) {
                    return ent.reduce((acc, [key, value]) => {
                        if (typeof value === 'object' && value !== null) {
                            acc.push([key, ...flattenEntries(Object.entries(value))]);
                        } else {
                            acc.push([key, value]);
                        }
                        return acc;
                    }, []);
                }

                function syncCartWithServer() {
                    // check for cart in local storage
                    var cartData = getCartFromLocalStorage();

                    // init cartDat with values if it does not exist
                    if (!cartData) {
                        cartData = {
                            total_items: 0,
                            cart_total: 0,
                            timestamp: Date.now()
                        };
                    }
                    // convert to an array of entries - makes comparing them much easier
                    var cartDataArray = Object.entries(cartData);

                    // get cart from server if exists
                    var cartServerData = {
                        "cart_total": 24.82,
                        "total_items": 1,
                        "total_logo_fees": 5,
                        "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a": {
                            "id": 91,
                            "name": "CornerStone Tall Select Lightweight Snag-Proof Polo",
                            "price": "24.82",
                            "qty": 1,
                            "add_item_uid": "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a",
                            "image": "product-images\/black_tlcs418.jpg",
                            "code": "TLCS418",
                            "logoFee": 5,
                            "tax": 2.6837999999999997,
                            "price_id": "3139",
                            "color_id": "6",
                            "color_name": "Black",
                            "size_id": "15",
                            "size_name": "Large & Tall (LT)",
                            "comment": "",
                            "logo": "dept_logos\/B_Black_Dept.png",
                            "logo_id": "31",
                            "deptPatchPlace": "Below Logo",
                            "fy": "2526",
                            "rowid": "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a",
                            "subtotal": 24.82,
                            "logoFeeSubtotal": 5,
                            "subtotalWithLogoFee": 29.82
                        }
                    };
                    var cartServerArray = Object.entries(cartServerData);

                    // see how old the cart in local storage is.
                    // TODO we want to purge after 90 days (maybe... )
                    howOldIsLocalStorage(cartData.timestamp);

                    cartServerArray.forEach(serverItem => {
                        if (!findItemByUid(cartDataArray, serverItem.add_item_uid)) {
                            cartDataArray.push(serverItem);
                        }
                    })
                    cartDataArray.forEach(dataItem => {
                        if (!findItemByUid(cartServerArray, dataItem.add_item_uid)) {
                            cartServerArray.push(dataItem)
                        }
                    })


                    if (cartData.total_items == 0 && cartData.cart_total == 0 && cartServerData.total_items != 0) {
                        //console.log('Writing server data to local storage');
                        setCartInLocalStorage(cartServerData);
                        return
                    } else if (cartData.total_items != 0 && cartServerData.total_items == 0 && howOldIsLocalStorage(cartData
                            .timestamp) > 1440000) {
                        fetch('cartSync.php', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(cartServerArray)
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success:', data);
                            })
                            .catch((error) => {
                                console.error('Error: ', error);
                            });
                    } else if (cartServerData.total_items > 0) {
                        setCartInLocalStorage(cartServerArray)
                    }
                }
                syncCartWithServer();

                // Function to update cart totals with logo fees from localStorage
                function updateCartTotals() {
                    var cartData = getCartFromLocalStorage();
                    if (cartData && cartData.total_logo_fees) {
                        var logoFees = parseFloat(cartData.total_logo_fees) || 0;
                        var subtotal = 24.82;
                        var taxRate = 0.09;
                        var salesTax = (subtotal + logoFees) * taxRate;
                        var cartTotal = subtotal + logoFees + salesTax;

                        // Update the display elements
                        document.getElementById('logo-fees-display').textContent = logoFees.toFixed(2);
                        document.getElementById('sales-tax-display').textContent = salesTax.toFixed(2);
                        document.getElementById('cart-total-display').textContent = cartTotal.toFixed(2);

                        // Show the logo fees row
                        document.querySelector('.logo-fees-row').style.display = logoFees > 0 ? 'table-row' : 'none';
                    } else {
                        // Hide logo fees row if no logo fees
                        document.querySelector('.logo-fees-row').style.display = 'none';
                    }
                }

                // Update totals when the slideout loads
                document.addEventListener('DOMContentLoaded', function() {
                    updateCartTotals();
                });

                // Also update when the cart slideout is opened
                document.addEventListener('toggle', function(e) {
                    if (e.target.id === 'cart-slideout' && e.target.matches(':popover-open')) {
                        updateCartTotals();
                    }
                });
            </script>

            <style>
                /* Modern Cart Slideout Styling */
                .cart-slideout {
                    background: #ffffff;
                    border-radius: 16px;
                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.06);
                    border: 1px solid rgba(0, 0, 0, 0.05);
                    overflow: hidden;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
                }

                .cart-header-holder {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    padding: 20px 24px;
                    margin: 0;
                    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }

                .cart-header-holder h1 {
                    color: #ffffff;
                    margin: 0;
                    font-size: 1.5rem;
                    font-weight: 600;
                    letter-spacing: -0.5px;
                }

                .cart-header-holder .btn-close {
                    background: rgba(255, 255, 255, 0.2);
                    border: none;
                    border-radius: 50%;
                    width: 32px;
                    height: 32px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    color: #ffffff;
                    font-size: 18px;
                    font-weight: bold;
                }

                .cart-header-holder .btn-close:hover {
                    background: rgba(255, 255, 255, 0.3);
                    transform: rotate(90deg);
                }

                .cart-slide-row {
                    padding: 0;
                }

                .cart-table-holder {
                    padding: 0;
                    margin: 0;
                }

                .cart-slideout .table {
                    margin: 0;
                    border: none;
                    background: transparent;
                }

                .cart-slideout .thead-dark {
                    background: #f8f9fa;
                    border-bottom: 2px solid #e9ecef;
                }

                .cart-slideout .thead-dark th {
                    background: #f8f9fa;
                    color: #495057;
                    font-weight: 600;
                    font-size: 0.875rem;
                    padding: 16px 20px;
                    border: none;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                    border-radius: 0;
                }

                .cart-slideout tbody tr {
                    border-bottom: 1px solid #f1f3f4;
                    transition: background-color 0.2s ease;
                }

                .cart-slideout tbody tr:hover {
                    background-color: #f8f9fb;
                }

                .cart-slideout tbody tr:last-child {
                    border-bottom: none;
                }

                .cart-slideout td {
                    color: #2c3e50 !important;
                    padding: 16px 20px;
                    border: none;
                    font-size: 0.95rem;
                    vertical-align: middle;
                }

                .cart-slideout .start-totals td,
                .cart-slideout .logo-fees-row td {
                    background: #f8f9fa;
                    border-top: 2px solid #e9ecef;
                    font-weight: normal;
                    font-style: italic;
                    font-size: 1rem;
                }

                /* Sales Tax row styling to match other summary rows */
                .cart-slideout tbody tr:nth-last-child(2) td {
                    background: #f8f9fa;
                    border-top: 2px solid #e9ecef;
                    font-weight: normal;
                    font-style: italic;
                    font-size: 1rem;
                }

                .cart-slideout .cart-total-row td {
                    background: #2c3e50;
                    color: #ffffff !important;
                    font-size: 1.1rem;
                    font-weight: bold;
                    font-style: normal;
                    border-top: 3px solid #667eea;
                    border-radius: 0 !important;
                }

                .cart-slideout .cart-total-row td:first-child,
                .cart-slideout .cart-total-row td:last-child {
                    border-radius: 0 !important;
                }

                .cart-slideout .logo-fees-row {
                    display: none;
                    /* Hidden by default, shown via JavaScript when logo fees exist */
                }

                .a-right {
                    text-align: right;
                }

                /* Delete Button Styling */
                .btn-delete {
                    background: #ff4757;
                    border: none;
                    border-radius: 8px;
                    padding: 8px 10px;
                    font-size: 1rem;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    box-shadow: 0 2px 4px rgba(255, 71, 87, 0.2);
                }

                .btn-delete:hover {
                    background: #ff3742;
                    transform: translateY(-1px);
                    box-shadow: 0 4px 8px rgba(255, 71, 87, 0.3);
                }

                .btn-delete:active {
                    transform: translateY(0);
                    box-shadow: 0 1px 2px rgba(255, 71, 87, 0.3);
                }

                /* Buttons Container */
                .slideoutButtonsHolder {
                    padding: 24px;
                    margin-bottom: 20px;
                    display: flex;
                    justify-content: space-between;
                    gap: 16px;
                    background: #f8f9fa;
                    border-top: 1px solid #e9ecef;
                    width: 100%;
                }

                .slideoutButtonsHolder .btn {
                    flex: 1;
                    padding: 12px 20px;
                    font-weight: 600;
                    border-radius: 8px;
                    border: 2px solid transparent;
                    text-decoration: none;
                    font-size: 0.95rem;
                    transition: all 0.2s ease;
                    cursor: pointer;
                    text-align: center;
                    display: inline-block;
                }

                .slideoutButtonsHolder .btn-outline-secondary {
                    background: #ffffff;
                    border-color: #6c757d;
                    color: #6c757d;
                }

                .slideoutButtonsHolder .btn-outline-secondary:hover {
                    background: #6c757d;
                    color: #ffffff;
                    transform: translateY(-1px);
                    box-shadow: 0 4px 8px rgba(108, 117, 125, 0.2);
                }

                .slideoutButtonsHolder .btn-success {
                    background: #28a745;
                    border-color: #28a745;
                    color: #ffffff;
                    box-shadow: 0 2px 4px rgba(40, 167, 69, 0.2);
                }

                .slideoutButtonsHolder .btn-success:hover {
                    background: #218838;
                    border-color: #218838;
                    transform: translateY(-1px);
                    box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
                }

                .slideoutButtonsHolder a {
                    text-decoration: none;
                }

                /* Empty Cart Styling */
                .cart-slideout tbody tr td p {
                    text-align: center;
                    color: #6c757d;
                    font-style: italic;
                    margin: 20px 0;
                    font-size: 1rem;
                }

                /* Responsive Design */
                @media (max-width: 768px) {
                    .cart-slideout {
                        border-radius: 12px;
                        margin: 10px;
                    }

                    .cart-header-holder {
                        padding: 16px 20px;
                    }

                    .cart-header-holder h1 {
                        font-size: 1.3rem;
                    }

                    .cart-slideout .thead-dark th {
                        padding: 12px 16px;
                        font-size: 0.8rem;
                    }

                    .cart-slideout td {
                        padding: 12px 16px;
                        font-size: 0.9rem;
                    }

                    .slideoutButtonsHolder {
                        padding: 20px;
                        flex-direction: column;
                    }

                    .slideoutButtonsHolder .btn {
                        margin-bottom: 8px;
                    }
                }

                @media (max-width: 480px) {

                    .cart-slideout .thead-dark th:nth-child(2),
                    .cart-slideout td:nth-child(2) {
                        display: none;
                    }

                    .cart-slideout .thead-dark th:first-child {
                        width: 60%;
                    }

                    .cart-slideout .thead-dark th:nth-child(3) {
                        width: 25%;
                    }

                    .cart-slideout .thead-dark th:last-child {
                        width: 15%;
                    }
                }
            </style>

            <div class="cart-slideout" id="cart-slideout">
                <div class="cart-header-holder">
                    <h1>Your Cart</h1>
                    <button popovertarget="cart-slideout" popovertargetaction="hide" class="btn-close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="cart-slide-row">
                    <div class="cart-table-holder">
                        <table class="cart table table-striped">
                            <thead class="thead-dark">
                                <tr>
                                    <th width='55%'>Product</th>
                                    <th width='15%'>Qty</th>
                                    <th width='20%' class='a-right'>Price</th>
                                    <th width='10%'></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>CornerStone Tall Select Lightweight Snag-Proof Polo</td>
                                    <td>1 </td>
                                    <td class='a-right'>$24.82 </td>
                                    <!-- <td class='a-right'><i class="fa fa-trash" aria-hidden="true" onclick="return confirm('Are you sure to remove cart item?')?window.location.href='cartAction.php?action=removeCartItem&id=19a2b75569930f4cf48062e92b97f8e26a592fe9a6a':false;" title="Remove Item"></i></td> -->
                                    <td class='a-right'>
                                        <button class="btn-delete"
                                            onclick="return confirm('Are you sure to remove cart item?')?window.location.href='cartAction.php?action=removeCartItem&id=19a2b75569930f4cf48062e92b97f8e26a592fe9a6a':false;"
                                            title="Remove Item" aria-label="Remove Item">
                                            üóëÔ∏è
                                        </button>
                                    </td>
                                </tr>

                                <tr class='start-totals'>
                                    <td colspan="2"><strong>Sub-Total</strong></td>
                                    <td colspan="2" class='a-right'>
                                        $24.82 </td>
                                </tr>

                                <tr class="logo-fees-row">
                                    <td colspan="2"><strong>Logo Fees:</strong></td>
                                    <td colspan="2" class="a-right logo-fees-amount">
                                        $<span id="logo-fees-display">0.00</span>
                                    </td>
                                </tr>

                                <tr>
                                    <td colspan="2"><strong>Sales Tax:</strong></td>
                                    <td colspan="2" class="a-right">
                                        $<span id="sales-tax-display">2.23</span>
                                    </td>
                                </tr>

                                <tr class="cart-total-row">
                                    <td colspan="2"><strong>Cart Total:</strong></td>
                                    <td colspan="2" class="a-right">
                                        <strong>$<span id="cart-total-display">27.05</span></strong>
                                    </td>
                                </tr>


                            </tbody>
                        </table>
                    </div>
                    <div class="slideoutButtonsHolder">
                        <a href="./viewCart.php"><button class="btn btn-outline-secondary">View Cart Page</button></a>
                        <a href="./checkout.php"><button class="btn btn-success">Go to Checkout</button></a>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <script>
        addPopoverAutoClose('#womans-menu-popover');
        addPopoverAutoClose('#mens-menu-popover');
    </script>


    <style>
        #mens-menu-anchor {
            anchor-name: --mens-menu-popover;
        }

        #womans-menu-anchor {
            anchor-name: --womans-menu-popover;
        }

        #navbar-popover-toggle {
            anchor-name: navbar-popover-toggle
        }


        #mens-menu-popover[popover] {
            transition:
                display 0.3s allow-discrete,
                opacity 0.3s,
                translate 0.3s;
            transition-timing-function: ease-in;
            opacity: 0;
            translate: 0 30px;
            position: absolute;
            inset: unset;
            top: anchor(--mens-menu-popover bottom);
            left: anchor(--mens-menu-popover left);
        }

        #mens-menu-popover[popover]:popover-open {
            opacity: 1;
            translate: 0 0;
            transition-timing-function: ease-out;
        }

        #womans-menu-popover[popover] {
            transition:
                display 0.3s allow-discrete,
                opacity 0.3s,
                translate 0.3s;
            transition-timing-function: ease-in;
            opacity: 0;
            translate: 0 30px;
            position: absolute;
            inset: unset;
            top: anchor(--womans-menu-popover bottom);
            left: anchor(--womans-menu-popover left);
        }



        #womans-menu-popover[popover]:popover-open {
            opacity: 1;
            translate: 0 0;
            transition-timing-function: ease-out;
        }

        @starting-style {
            #mens-menu[popover]:popover-open {
                opacity: 0;
                translate: 0 50px;
            }

            #womans-menu[popover]:popover-open {
                opacity: 0;
                translate: 0 30px;
            }
        }

        #anchored-menu[popover]:popover-open {
            opacity: 1;
            translate: 0 0;
            transition-timing-function: ease-out;
        }

        @keyframes sticky-parallax-header-move-and-size {
            from {
                background-position: 50% 0;
                height: 100vh;
                font-size: calc(4vw + 1em);
            }

            to {
                background-position: 50% 100%;
                background-color: #0b158450;
                /* background-color: transparent; */
                height: 10vh;
                font-size: 2em;
            }
        }

        @keyframes alert-banner-fade {
            from {
                opacity: 1;
                /* height: 100%; */

            }

            to {
                opacity: 0;

                height: 0px;
                margin: 0;
                padding: 0;
            }
        }

        @keyframes nav-slide-up {
            from {
                /* background-position: 50% 0; */
                translateY: 100%;
            }

            to {
                /* background-position: 50% 100%; */
                translateY: 0;
                background-color: #00000080;
                /* height: 100vh; */
                /* font-size: calc(4vw + 1em); */
            }
        }

        @keyframes nav-popover-slide-in-from-right {
            from {
                translateX: 100%;
                opacity: 0;
            }

            to {
                translateX: 0;
                opacity: 1;
            }
        }

        #sticky-parallax-header {
            color: #fff;
            height: 100vh;
            width: 100%;
            /* background-image: url("rachel-jarboe-tZpmdFfU5gQ-unsplash.jpg"); */
            background-image: url("./County-Store-Image.png");
            background-size: cover;
            background-position: 50% 50%;
            background-blend-mode: soft-light;
            display: grid;
            place-items: center;
            text-align: center;
            font-size: calc(4vw + 1em);
        }

        #sticky-parallax-header {
            position: fixed;
            top: 0;

            animation: sticky-parallax-header-move-and-size linear forwards;
            animation-timeline: scroll();
            animation-range: 0vh 90vh;
        }

        #alert-banner {
            animation: alert-banner-fade linear forwards;
            animation-timeline: scroll();
            animation-range: 20vh 80vh;
        }

        .navbar {
            animation: nav-slide-up linear forwards;
            animation-timeline: scroll();
            animation-range: 20vh 80vh;
        }

        @keyframes mini-nav-slide {
            from {
                translate: 60vi;
                opacity: 0;
            }

            to {
                translate: 0;
                opacity: 1;
            }
        }

        .navbar-popover {
            background: linear-gradient(to right, #808080, #434343);


            button:hover,
            a:hover {
                color: #ffffff;
            }

            .btn-close {
                color: #ffffff;
            }
        }

        #navbar-popover {
            margin: 20px;
            block-size: 36vb;
            inline-size: 23vi;
            inset-inline-start: unset;
            inset-inline-end: 0;
            animation: nav-popover-slide-in-from-right 0.5s ease-in-out;
            /* display: flex; */
            overflow: hidden;
            translate: 0 98px;

        }

        #cart-slideout[open] {
            animation: slide 0.5s ease-in-out reverse;
        }

        ::backdrop {
            backdrop-filter: blur(5px);
        }

        /* body {
            padding-top: 100vh;
        } */
    </style>
    <script src="./functions/isThisFiscalYear.js"></script>
    <script src="./functions/renderProductDetails.js"></script>
    <link href="./style/customProductDetails.css" rel="stylesheet" />
    <script>
        function removeCommasAndSpaces(str) {
            return str.replace(/,/g, '').replace(/\s/g, '');
        }


        function setFiscalYear() {
            // console.log("Checking FY function")
            newFiscalYear = fiscalYear()
            fyStart = newFiscalYear[0];
            fyEnd = newFiscalYear[1];
            thisFiscalYear = (fyStart + fyEnd);
            return thisFiscalYear;
        }
        // console.log(setFiscalYear());

        function makeDollar(str) {
            let amount = parseFloat(str);
            return `$${amount.toFixed(2)}`;
        }

        function unDollar(str) {
            var numStr = str.replace(/[$,]/g, '');
            var numFloat = parseFloat(numStr);
            return numFloat;
        }

        function getCartTotal() {
            var storeCart = {
                "cart_total": 24.82,
                "total_items": 1,
                "total_logo_fees": 5,
                "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a": {
                    "id": 91,
                    "name": "CornerStone Tall Select Lightweight Snag-Proof Polo",
                    "price": "24.82",
                    "qty": 1,
                    "add_item_uid": "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a",
                    "image": "product-images\/black_tlcs418.jpg",
                    "code": "TLCS418",
                    "logoFee": 5,
                    "tax": 2.6837999999999997,
                    "price_id": "3139",
                    "color_id": "6",
                    "color_name": "Black",
                    "size_id": "15",
                    "size_name": "Large & Tall (LT)",
                    "comment": "",
                    "logo": "dept_logos\/B_Black_Dept.png",
                    "logo_id": "31",
                    "deptPatchPlace": "Below Logo",
                    "fy": "2526",
                    "rowid": "19a2b75569930f4cf48062e92b97f8e26a592fe9a6a",
                    "subtotal": 24.82,
                    "logoFeeSubtotal": 5,
                    "subtotalWithLogoFee": 29.82
                }
            };
            if (storeCart) {
                return storeCart;
            }
            return;

        }

        function getCurrentProductPrice() {
            var hiddenPriceInput = document.getElementById('productPrice')
            var priceDisplay = document.getElementById('price-in-summary')
            priceDisplay.textContent = makeDollar(hiddenPriceInput.value);
        }

        function updateHiddenPriceInput(radio) {
            const transition = document.startViewTransition(() => {


                var hiddenInput = document.getElementById('productPrice');
                hiddenInput.value = radio.dataset.priceval;
                var sizeHiddenInput = document.getElementById('size_id');
                sizeHiddenInput.value = radio.dataset.sizeid;
                var sizeNameHiddenInput = document.getElementById('size_name');
                sizeNameHiddenInput.value = radio.dataset.sizename;
                getCurrentProductPrice();
                updateCurrentPrice();
                calculateSubTotal();
                calculateTax();
                calculateSelectedTotal();
                calculateNewTotal();
            })
        }

        function getCurrentQty() {
            var currentQty = document.getElementById('itemQuantity').value;
            return currentQty;
        }

        function updateCurrentPrice() {
            var priceInSummary = document.getElementById('productPrice').value;
            var priceInSummaryHolder = document.getElementById('price-in-summary');
            priceInSummaryHolder.textContent = makeDollar((priceInSummary * getCurrentQty()))
        }

        function calculateSubTotal() {
            var subTotalInSummary = document.getElementById('sub-in-summary')
            var logoFeeInSummary = document.getElementById('logo-fee-in-summary').textContent
            var priceInSummary = document.getElementById('price-in-summary').textContent;
            var subTotal = ((unDollar(logoFeeInSummary) + (unDollar(priceInSummary))))
            subTotalInSummary.textContent = makeDollar(subTotal);
        }

        function calculateTax() {
            var subTotalInSummary = document.getElementById('sub-in-summary').textContent;
            var taxInSummary = document.getElementById('tax-in-summary');
            var taxRate = .09;
            var tax = (unDollar(subTotalInSummary) * taxRate);
            taxInSummary.textContent = makeDollar(tax);
        }

        function calculateSelectedTotal() {
            var totalInSummary = document.getElementById('total-in-summary');
            var subTotalInSummary = document.getElementById('sub-in-summary').textContent;
            var taxInSummary = document.getElementById('tax-in-summary').textContent;
            var selectedTotal = (unDollar(subTotalInSummary) + unDollar(taxInSummary))
            totalInSummary.textContent = makeDollar(selectedTotal)
        }

        function calculateNewTotal() {
            var newTotalInSummary = document.getElementById('new-total-in-summary');
            var cartTotal = (getCartTotal().cart_total * 1.09);
            var totalInSummary = document.getElementById('total-in-summary').textContent;
            newTotal = (cartTotal + unDollar(totalInSummary));
            newTotalInSummary.textContent = makeDollar(newTotal);
        }

        function updateLogoImage(val) {
            var logoImageInSummary = document.getElementById('logo-img-in-summary')
            var logoFormInput = document.getElementById('logo-url')
            var selectedLogo = document.getElementById(val).dataset.url
            var hiddenLogoIdInput = document.getElementById('logo_id')
            logoImageInSummary.src = selectedLogo
            logoFormInput.value = selectedLogo;
            hiddenLogoIdInput.value = val;
        }

        function updateLogoFeeAddOn(val) {
            var logoFeeUpChargeHiddenInput = document.getElementById('logo_upCharge')
            if (val === 'Left Sleeve') {
                logoFeeUpChargeHiddenInput.value = 5.00
                showToast('This option added $5.00 per item to your cost')
                handleDeptNamePatch()
            } else if (val === 'No Dept Name') {
                handleDeptNamePatch()
            } else {
                logoFeeUpChargeHiddenInput.value = 0.00
                handleDeptNamePatch()
            }
            updateCurrentQty();
        }
        // updates the qty in the summary display as wel as the logo fees
        function updateCurrentQty() {
            const transition = document.startViewTransition(() => {


                var qtyInSummary = document.getElementById('qty-in-summary')
                var logoFeeInSummary = document.getElementById('logo-fee-in-summary')
                var logoUpCharge = document.getElementById('logo_upCharge').value;
                qtyInSummary.textContent = getCurrentQty();
                var totalLogoFee = (5 + parseInt(logoUpCharge));
                logoFeeInSummary.textContent = makeDollar((getCurrentQty() * totalLogoFee))
                updateCurrentPrice();
                calculateSubTotal();
                calculateTax();
                calculateSelectedTotal();
                calculateNewTotal();
            });
        }

        function showMessageAndRedirect() {
            var errorPopover = document.getElementById('errorMessage');
            errorPopover.showPopover();
        }

        function fetchProductData(id) {
            fetch('fetchProductDetails.php?id=' + 91)
                .then((response) => response.json())
                .then((data) => {
                    console.log(data);
                    if (data['product_message']) {
                        console.log(data['product_message']);
                        showMessageAndRedirect()
                    } else {
                        renderProductDetails(data);
                        getCurrentProductPrice();
                        matchHeights();
                        updateColorImage(data['color_data'][0].color);
                        updateCurrentQty();
                        calculateSubTotal();
                    }
                    // getCurrentQty();

                });
        }
        fetchProductData();
        // Does anyone who would have access to read this code really need a comment to explain what this does?


        const formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
        });

        // This onchange hander uses the updateColor function to update the value of the element with an ID of color_id. It sets the current value to a new color based on the passed in parameter val. Then it assigns the new color to the element which is included in the form action.

        function updateColor(val) {
            c = document.getElementById('color_id').value;
            newc = val;
            document.getElementById("color_id").value = newc;
        }
        // The function formatColorValueForUrl takes in the value of the name of a color and removes characters other than letters and then makes them all lower case. This is then inserted into the "src" for the color swatch image
        function formatColorValueForUrl(str) {
            var noSpaces = str.replace(/[\s/]/g, '');
            var lowercaseString = noSpaces.toLowerCase();
            return lowercaseString;
        }
        // console.log(formatColorValueForUrl('Biscuit / True Blue'));
        // Function to convert hex color to RGB
        function hexToRgb(hex) {

            hex = hex.replace('#', '');
            // convert to stupid rgb
            var bigint = parseInt(hex, 16);
            var r = (bigint >> 16) & 255;
            var g = (bigint >> 8) & 255;
            var b = bigint & 255;

            return {
                r: r,
                g: g,
                b: b
            };
        }
        // the function updateColorImage takes the value from the above function and updates the box shadow around the product image
        // also updates hidden inputs of color name and color id
        function updateColorImage(val) {
            // console.log(val)
            var el = document.getElementById(val);
            // console.log(el)
            var hiddenColorNameInput = document.getElementById('color_name');
            hiddenColorNameInput.value = el.dataset.colorname;
            var hiddenColorIdInput = document.getElementById('hidden_color_id');
            hiddenColorIdInput.value = el.dataset.colorid;
            var hexVal = el.dataset.hex;
            var rgbColor = hexToRgb(hexVal);
            var imageHolder = document.getElementById('product-image-holder')
            var toastHolder = document.getElementById('myToast')
            var container = document.getElementById('container')

            imageHolder.style.boxShadow = `0px 0px 15px -5px rgba(${rgbColor.r},${rgbColor.g},${rgbColor.b},0.75)`;
            toastHolder.style.boxShadow = `0px 0px 15px 1px rgba(${rgbColor.r},${rgbColor.g},${rgbColor.b},0.75)`;
            // container.style.boxShadow = `0px 0px 55px -25px rgba(${rgbColor.r},${rgbColor.g},${rgbColor.b},0.75)`;

        }


        // function to update the product image based on the color selected
        function updateProductImage(val) {
            updateColorImage(val);
            // updateHiddenColorInput(val);
            var productImage = document.querySelector('.product-image');
            var imageHiddenInput = document.getElementById('image-url');
            var productCode = document.getElementById('product-name').innerText;
            var newProductImage = formatColorValueForUrl(val) + '_' + productCode + '.jpg';
            productImage.src = './product-images/' + newProductImage.toLowerCase();
            imageHiddenInput.value = './product-images/' + newProductImage.toLowerCase();

        }



        function changeLogo(img) {
            const logoImg = document.getElementById('logo-img');
            const onShirtLogo = document.getElementById('lil-logo');
            const currentPrice = document.getElementById('productPrice').value;
            logoImg.src = img;
            onShirtLogo.src = img;
            // unhideLogo();
            //logoPriceIncrease();
        };

        function forBootsView() {
            const logoDetailsHolder = document.getElementById('logo-info-holder')
            const logoImage = document.getElementById('lil-logo')
            logoDetailsHolder.classList.add('hidden')
            logoImage.classList.add('hidden')
        }

        function showPopover(target) {
            const popovertarget = document.getElementById(target);
            // console.log(target)
            // console.log(popovertarget)
            popovertarget.showPopover()
        }

        function isSafetyProducts() {
            const itemQuantity = document.getElementById('itemQuantity')
            itemQuantity.min = 24;
            itemQuantity.value = 24;
            showPopover('safetyProductsPopover')
        }

        function disableSelectDepName() {
            var select = document.getElementById('deptPatchPlace')
            select.attributes.add('disabled')
        }

        function backToIndex() {
            window.location.replace('index.php')
        }
    </script>
    </head>



    <body class="body">
        <div class="container" id="container">
            <!-- // ? This is the div where the product name and code are rendered. Values are also used in some image update functions  -->
            <div class="product-name-holder" id="product-name-holder"></div>
            <div class="another-container" id="another-container">
                <!-- // ? this is where the product image gets rendered -->



                <div class="details-about-details">
                    <!--//? This is the div where the submit form is rendered -->
                    <div id='new-options-form'></div>
                </div>
                <span class='product-image-holder' id='product-image-holder'
                    view-transition-group="image-transition"></span>
                <!-- // ?This is the div where the summary of the users selection is rendered -->
                <div class="select-summary" id="select-summary"></div>
            </div>
            <div class="button-holder">
                <a href=https://store.berkeleycountysc.gov/mens-shirts-view.php><button class="btn btn-primary" type="button"> Continue
                        Shopping </button></a>
                <button type="submit" form="options" class="btn btn-success"><span> Add to Cart
                    </span></button>
            </div>


            <!-- This was originaly intended to be used as a notification for a product being added to the cart - but the page reloads when something as added to the cart so it is useless... I am keeping in the code because I WILL find some use for these toast messages! -->
            <div id="myToast">
                <div class="toast-header">
                    ‚ö†Ô∏è Price Change Alert
                    <small>1 sec ago</small>
                    <button type="button" class="btn-close ms-2 mb-1" data-bs-dismiss="toast" onclick="eatToast()"></button>
                </div>
                <div class="toast-body">
                    <p id="price_toast_message"></p>
                </div>
            </div>
            <!-- <div class="size-chart-holder">
                    <table class="size-chart">
    <thead>
        <tr>
            <th></th>
            <th>XS</th>
            <th>S</th>
            <th>M</th>
            <th>L</th>
            <th>XL</th>
            <th>XXL</th>
            <th>3XL</th>
            <th>4XL</th>
            <th>5XL</th>
            <th>6XL</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Size</td>
            <th>2</th>
            <th>4/6</th>
            <th>8/10</th>
            <th>12/14</th>
            <th>16/18</th>
            <th>20/22</th>
            <th>24/26</th>
            <th>28/30</th>
            <th>32/34</th>
            <th>36/38</th>
        </tr>
        <tr>
            <td>Bust</td>
            <th>32-34</th>
            <th>35-36</th>
            <th>37-38</th>
            <th>39-41</th>
            <th>42-44</th>
            <th>45-47</th>
            <th>45-51</th>
            <th>52-55</th>
            <th>56-69</th>
            <th>60-63</th>
        </tr>
    </tbody>
</table>                </div> -->
        </div>
        <div id="safetyProductsPopover" class="safetyProductsPopover" popover=manual>
            <button class="btn-close ms-2 mb-1" popovertarget="safetyProductsPopover" popovertargetaction="hide">
                <span aria-hidden=‚Äùtrue‚Äù></span>
                <span class="sr-only">Close</span>
            </button>
            <p>This has a minimum order quantity of 24. Currently the only department approved for ordering this product is
                Stormwater / Roads & Bridges. If interested in this product please contact store@berkeleycountysc.gov for
                more information.</p>
        </div>
        <div id="errorMessage" class="errorMessage" popover=manual>
            <div class="errorMessage-header">
                <span class="errorMessage-icon">‚ö†Ô∏è</span>
                <h3 class="errorMessage-title">Product Unavailable</h3>
                <button class="errorMessage-close" popovertarget="errorMessage" onclick="backToIndex()" aria-label="Close">√ó</button>
            </div>
            <div class="errorMessage-body">
                <p class="errorMessage-text">We're sorry, but this product is no longer available. It may have been discontinued or removed from our catalog.</p>
            </div>
            <div class="errorMessage-footer">
                <button class="errorMessage-button" onclick="backToIndex()">Return to Products</button>
            </div>
        </div>

    </body>

    <footer>
        <div class='footer-holder'>
            <p>&#169; 2025</p>
            <p> Developed by <a href='https://berkeleycountysc.gov/dept/it/' class='font-weight-bold' target='_blank'>Berkeley County Information Technology</a></p>
            <p><a href='https://store.berkeleycountysc.gov/changelogView.php' target='_blank'> App Version Documentation</a></p>
        </div>
    </footer>
    <style>
        .footer-holder {
            /* position: relative; */
            position: fixed;
            margin-top: 10px;
            bottom: 0;
            display: flex;
            justify-content: space-between;
            padding-top: 20px;
            padding-left: 5%;
            padding-right: 5%;
            background-color: #ffffff;
            color: #000000;
            z-index: 0;
            width: 100vw;
        }


        a {
            text-decoration: none;
            color: inherit;
            /* font-weight: bolder; */
        }

        .far-right {
            margin-left: 100px;
        }
    </style>
    <script>
        // function to make & show toast messags. No real use case for them... yet....
        // I should really move this its own file....
        function showToast(msg) {
            console.log(msg);
            var toast = document.getElementById('myToast');
            var msgBlock = document.getElementById('price_toast_message');
            console.log(msgBlock);
            msgBlock.innerText = msg;
            toast.className = "show";
            setTimeout(function() {
                toast.className = toast.className.replace("show", "hideToast");
            }, 3000);
        }

        function eatToast() {
            var toast = document.getElementById('myToast').classList.replace('show', 'eatToast');
        }
    </script>
    <script>
        // Function to add "_NO" to the end of the filename
        function addNoToFileName(filename) {
            if (filename.includes('_NO')) {
                return filename; // "_NO" is already present, no need to modify ... except when there is.... hmmmm
            } else {
                const dotIndex = filename.lastIndexOf('.');
                const baseName = filename.substring(0, dotIndex); // Get base name without extension
                const extension = filename.substring(dotIndex); // Grab the extension
                return baseName + '_NO' + extension;
            }
        }

        // Remove "_NO" from the end of the filename when needed.... maybe this all lives in a switch statement based on the state of the department name details?? Grab the current value of that and then case|switch ? 
        function removeNoFromFileName(filename) {
            return filename.replace(/_NO(\.[^.]+)$/, '$1');
        }
        // helper function to parse the image url to push into the hidden 
        // input as relative instead of absolute. its a little hacky but what ya gonna do?
        function convertAbsToRel(url) {
            const parsedUrl = new URL(url);
            let relativePath = parsedUrl.pathname.split('/').filter(segment => segment !== 'county_store');
            relativePath.shift();
            return relativePath.join('/');
        }


        function handleDeptNamePatch() {
            const selectElement = document.getElementById('deptPatchPlace');
            const selectedValue = selectElement.value;
            //console.log("Dept Name Selected Value is: ", selectedValue);

            // const imageElement = document.getElementById('lil-logo');
            const imageElement = document.getElementById('logo-img-in-summary');
            const imageUrlHiddenInput = document.getElementById('logo-url');
            //console.log('ie11 ', imageElement);

            const oldSrc = imageElement.src;
            //console.log('oldSrc is: ', oldSrc);
            const fileName = oldSrc.split('/').pop();
            //console.log("File Name ", fileName);

            if (imageElement.complete && imageElement.src) {
                const oldSrc = imageElement.src;
                //console.log('oldSrc is: ', oldSrc);
                const fileName = oldSrc.split('/').pop();
                //console.log("File Name ", fileName);

                switch (selectedValue) {
                    case 'No Dept Name':
                    case 'Back of Hat':
                    case 'Left Sleeve':
                        //console.log('left sleeve');
                        const newFileName = addNoToFileName(fileName);
                        const newSrc = oldSrc.replace(fileName, newFileName);
                        imageElement.src = newSrc;
                        imageUrlHiddenInput.value = convertAbsToRel(newSrc)
                        break;

                    case 'Below Logo':
                        //console.log('Below Logo')
                        const fileNameWithoutNo = removeNoFromFileName(fileName);
                        const newSrcWithoutNo = oldSrc.replace(fileName, fileNameWithoutNo);
                        imageElement.src = newSrcWithoutNo;
                        imageUrlHiddenInput.value = convertAbsToRel(newSrcWithoutNo)
                        break;

                        // case 'Back of Hat':
                        // Do nothing
                        // break;

                    default:
                        // console.log('Invalid selection');
                        break;
                }
            }
        }
        // we're gonna try this and see if we can make the element heights match dynamically
        function matchHeights() {
            // get target height
            var newOptionsForm = document.getElementById('new-options-form');
            var newOptionsFormHeight = newOptionsForm.offsetHeight;

            // Set the height tp match target
            var selectionSummary = document.getElementById('selection-summary');
            selectionSummary.style.height = newOptionsFormHeight + 'px';

            // set image holder height to the same why dont we
            var imageHolder = document.getElementById('product-image-holder');
            imageHolder.style.height = newOptionsFormHeight + 'px';
        }

        // Call the function initially to set the height in the render function to avoid race condition


        // This is in case the height changes dynamically... i dont think it will other than window resize ...
        // this doesnt seem to be firing ... stupid Google .... come back to it later 
        new MutationObserver(matchHeights).observe(document.getElementById('another-container'), {
            childList: true,
            subtree: true
        });
    </script>

</html>